

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Database storage &mdash; pygmin 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/scipy.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pygmin 0.1 documentation" href="index.html" />
    <link rel="next" title="pygmin.storage.Database" href="generated/pygmin.storage.Database.html" />
    <link rel="prev" title="pygmin.potentials.GMINPotential.test_potential" href="generated/pygmin.potentials.GMINPotential.test_potential.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="generated/pygmin.storage.Database.html" title="pygmin.storage.Database"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="generated/pygmin.potentials.GMINPotential.test_potential.html" title="pygmin.potentials.GMINPotential.test_potential"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pygmin 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="module-pygmin.storage"><span id="database"></span></span><div class="section" id="database-storage">
<h1>Database storage<a class="headerlink" href="#database-storage" title="Permalink to this headline">¶</a></h1>
<p>This module contains all the objects related to the Database class.
The database is the preferred method for storing minima and transition
states.  It is used in basinhopping to accumulate and keep track of
new minima as they are found.  And it is used heavily in DoubleEndedConnect
to keep track of minima and add new transition states.  The database
ensures that all minima and transition state objects are unique</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/pygmin.storage.Database.html#pygmin.storage.Database" title="pygmin.storage.Database"><tt class="xref py py-obj docutils literal"><span class="pre">Database</span></tt></a>([db,&nbsp;accuracy,&nbsp;connect_string,&nbsp;...])</td>
<td>Database storage class</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/pygmin.storage.Minimum.html#pygmin.storage.Minimum" title="pygmin.storage.Minimum"><tt class="xref py py-obj docutils literal"><span class="pre">Minimum</span></tt></a>(energy,&nbsp;coords)</td>
<td>The Minimum class represents a minimum in the database.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/pygmin.storage.TransitionState.html#pygmin.storage.TransitionState" title="pygmin.storage.TransitionState"><tt class="xref py py-obj docutils literal"><span class="pre">TransitionState</span></tt></a>(energy,&nbsp;coords,&nbsp;min1,&nbsp;min2)</td>
<td>Transition state object</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/pygmin.storage.Distance.html#pygmin.storage.Distance" title="pygmin.storage.Distance"><tt class="xref py py-obj docutils literal"><span class="pre">Distance</span></tt></a>(dist,&nbsp;min1,&nbsp;min2)</td>
<td>object to store &#8220;mindist&#8221; distances between minima</td>
</tr>
</tbody>
</table>
<div class="section" id="minimum">
<h2>Minimum<a class="headerlink" href="#minimum" title="Permalink to this headline">¶</a></h2>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/pygmin.storage.Minimum.html#pygmin.storage.Minimum" title="pygmin.storage.Minimum"><tt class="xref py py-obj docutils literal"><span class="pre">Minimum</span></tt></a>(energy,&nbsp;coords)</td>
<td>The Minimum class represents a minimum in the database.</td>
</tr>
</tbody>
</table>
<p>The Minimum object is the class uses to store a minima in the database.  Here by minimum we 
refer to a local minimum in the potential energy landscape, but it is really defined by
the energy and the coordinates.  It is also used heavily outside of the database as a way 
to unambiguously represent a minimum. Minima will compare equal only if they are the same minima.
Minima can also be hashed and used as keys or values in a dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">min1</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">add_minimum</span><span class="p">(</span><span class="n">energy1</span><span class="p">,</span> <span class="n">coords1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min2</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">add_minimum</span><span class="p">(</span><span class="n">energy2</span><span class="p">,</span> <span class="n">coords2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min1</span> <span class="o">==</span> <span class="n">min2</span> <span class="c">#  a valid comparison</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neighbors</span> <span class="o">=</span> <span class="p">{</span> <span class="n">min1</span><span class="p">:</span><span class="n">min2</span> <span class="p">}</span> <span class="c">#  also fine</span>
</pre></div>
</div>
<p>The above comparison relies on the fact that the database stores only unique minima (see 
below section for how it determines uniqueness).  
Thus Minimum objects should never be created manually,
you should always let the database do it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">min1</span> <span class="o">=</span> <span class="n">Minimum</span><span class="p">(</span><span class="n">energy1</span><span class="p">,</span> <span class="n">coords1</span><span class="p">)</span> <span class="c">#  DON&#39;T DO THIS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min2</span> <span class="o">=</span> <span class="n">Minimum</span><span class="p">(</span><span class="n">energy2</span><span class="p">,</span> <span class="n">coords2</span><span class="p">)</span> <span class="c">#  DON&#39;T DO THIS</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min1</span> <span class="o">==</span> <span class="n">min2</span>   <span class="c">#  NOT OK</span>
</pre></div>
</div>
<p>Minima can be access from the database in a number of ways, but most often by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">database</span><span class="o">.</span><span class="n">minim</span><span class="p">()</span> <span class="c">#  an iterator over minima sorted by energy</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When a minimum is added to the database</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">minimum1</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">add_minimum</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">the database does several checks to ensure that it is unique. First it checks
to make sure the energy is not within <cite>database.accuracy</cite> of any other minimum.
If the energy does compare similar, the database then compares the structures using
<cite>database.compareMinima()</cite>.  By default this structural comparison does nothing, but
it is a good idea for the user to set a comparison function approriate for their system.
See <a class="reference internal" href="structure_alignment.html#structure-alignment"><em>structural alignment</em></a> for more information about how
to define this function. Only after a minimum passes these tests is it added to the 
database as a unique Minimum.  If compares exact to an existing Minimum then that minimum
is returned by <cite>database.add_minimum()</cite>.</p>
</div>
</div>
<div class="section" id="transitionstate">
<h2>TransitionState<a class="headerlink" href="#transitionstate" title="Permalink to this headline">¶</a></h2>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/pygmin.storage.TransitionState.html#pygmin.storage.TransitionState" title="pygmin.storage.TransitionState"><tt class="xref py py-obj docutils literal"><span class="pre">TransitionState</span></tt></a>(energy,&nbsp;coords,&nbsp;min1,&nbsp;min2)</td>
<td>Transition state object</td>
</tr>
</tbody>
</table>
<p>The TransitionState object is used to store transition states in the database.
As with the Minimum class, TransitionState objects should never be created manually,
but always through the database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">add_transtion_state</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">minimum1</span><span class="p">,</span> <span class="n">minimum2</span><span class="p">,</span> 
<span class="go">                                      eigenval=eigelval, eigenvec=eigenvec)</span>
</pre></div>
</div>
<p>Transition states in the database are guaranteed to be unique by comparing both 
attached minima and by comparing the transition state energy.  Transition states
can be accessed from the database by:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">database</span><span class="o">.</span><span class="n">transition_states</span> <span class="c">#  an iterator over transition states</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ts</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">getTranstionState</span><span class="p">(</span><span class="n">minimum1</span><span class="p">,</span> <span class="n">minimum2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="distance">
<h2>Distance<a class="headerlink" href="#distance" title="Permalink to this headline">¶</a></h2>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/pygmin.storage.Distance.html#pygmin.storage.Distance" title="pygmin.storage.Distance"><tt class="xref py py-obj docutils literal"><span class="pre">Distance</span></tt></a>(dist,&nbsp;min1,&nbsp;min2)</td>
<td>object to store &#8220;mindist&#8221; distances between minima</td>
</tr>
</tbody>
</table>
<p>The Distance class is used to store <a class="reference internal" href="structure_alignment.html#structure-alignment"><em>mindist</em></a>
(best structural alignment) distances in the database.  We save these distances
because recalculating distances can be quite time consuming.  The use of Distance
is very similar to that of TransitionState:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">dist</span><span class="p">,</span> <span class="n">newcoords1</span><span class="p">,</span> <span class="n">newcoords2</span> <span class="o">=</span> <span class="n">mindist</span><span class="p">(</span><span class="n">minimum1</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">minimum2</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">database</span><span class="o">.</span><span class="n">setDistance</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">minimum1</span><span class="p">,</span> <span class="n">minimum2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">database</span><span class="o">.</span><span class="n">distances</span><span class="p">()</span> <span class="c">#  iterator over Distance objects</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">database</span><span class="o">.</span><span class="n">getDistance</span><span class="p">(</span><span class="n">minimum1</span><span class="p">,</span> <span class="n">minimum2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2>Database<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="generated/pygmin.storage.Database.html#pygmin.storage.Database" title="pygmin.storage.Database"><tt class="xref py py-obj docutils literal"><span class="pre">Database</span></tt></a>([db,&nbsp;accuracy,&nbsp;connect_string,&nbsp;...])</td>
<td>Database storage class</td>
</tr>
</tbody>
</table>
<p>The Database class is what deals with creating new Minimum and TransitionState objects
and ensuring that they are unique.  It stores the objects in an SQL database on the hard drive
(or optionally in memory).
The objects are persistent in the database and exist as soon as the Database class is 
connected to the database. If any value in the objects is changed, the changes are 
automatically persistent in the database.  Database uses the pypi package SQLAlchemy to handle
the interactions with the SQL database.</p>
<p>To connect to a database:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">()</span> <span class="c">#  create a database in memory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&quot;mydatabase.sqlite&quot;</span><span class="p">)</span> 
</pre></div>
</div>
<p>Database will load data from &#8220;mydatabase.sqlite&#8221; if it already exists, or create a new 
database with that name if it doesn&#8217;t.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>basinhopping doesn&#8217;t accept a database as a parameter, instead you should pass
a call back function function which will add the minima as they are found.
This function can be conveniently accessed by:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">minima_adder</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">minimum_adder</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bh</span> <span class="o">=</span> <span class="n">BasinHopping</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">potential</span><span class="p">,</span> <span class="n">takestep</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="n">minima_adder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Database storage</a><ul>
<li><a class="reference internal" href="#minimum">Minimum</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#transitionstate">TransitionState</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#distance">Distance</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#id1">Database</a><ul>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="generated/pygmin.potentials.GMINPotential.test_potential.html"
                        title="previous chapter">pygmin.potentials.GMINPotential.test_potential</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="generated/pygmin.storage.Database.html"
                        title="next chapter">pygmin.storage.Database</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/database.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="generated/pygmin.storage.Database.html" title="pygmin.storage.Database"
             >next</a> |</li>
        <li class="right" >
          <a href="generated/pygmin.potentials.GMINPotential.test_potential.html" title="pygmin.potentials.GMINPotential.test_potential"
             >previous</a> |</li>
        <li><a href="index.html">pygmin 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Victor Rühle, Jacob Stevenson.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>